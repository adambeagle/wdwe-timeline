'use strict';var wdweTimeline=function(){function b(){var F=t.canvas.getBoundingClientRect();u=!1,z=!1,C=q,B=new n(F.left,F.top),v=new k,w=new j,D=new m,v.init(),w.init(),window.addEventListener('setyear',g,!0),c()}function c(F){var G=new Date().getTime();if(F===void 0)F=G;else if(F+A<G)return console.log('Timeout'),z=!0,!1;return v.isReady()&&w.isReady()?void(u=!0,d()):(setTimeout(c,300,F),!0)}function d(){w.start(E),e(C)}function e(F,G){var H;G||(G=t.canvas),F=h(F),H=new CustomEvent('setyear',{detail:F,bubbles:!0}),G.dispatchEvent(H)}function f(F,G){var H;G||(G=t.canvas),H=new CustomEvent('slideyear',{detail:F,bubbles:!0}),G.dispatchEvent(H)}function g(F){var G=F.detail;C=G}function h(F){return F=parseInt(F),Math.max(Math.min(F,r),q)}function j(){function F(J){var K=J.detail;I.stop(),K>q&&I.play('ding'),I.play(J.detail)}function G(){I.stop(),I.play(C)}function H(J){I.toggleMute(),I.isMuted()?J.target.innerText='Unmute':(J.target.innerText='Mute',I.loop('bgmusic'))}var I=new l;this.init=function(){window.addEventListener('setyear',F,!0),I.init()},this.isReady=function(){return I.isReady()},this.start=function(J){var K=document.querySelector('.wdwe-container .mute');document.querySelector('.repeat-audio').addEventListener('click',G,!0),K.addEventListener('click',H,!0),t.canvas.addEventListener('click',function(){I.stop()},!0),J?H({target:K}):I.loop('bgmusic')}}function k(){function F(N){var O=N.detail;for(M=G(O);!M&&O>=q;)M=G(O--);t.drawImage(M,0,0,o,p)}function G(N){var O=L.get(N);return O?O.img:null}function H(N){var O=!1;this.img=new Image,this.img.src=N,this.isReady=function(){return O},this.img.onload=function(){O=!0}}const K=[1970,1971,1974,1975,1976,1982,1988,1989,1990,1991,1992,1994,1995,1996,1997,1998];var M,L=new Map;this.init=function(){var N;for(let O of K)N='images/timeline/'+O.toString()+'.jpg',L.set(O,new H(N));window.addEventListener('setyear',F,!0),window.addEventListener('slideyear',F,!0)},this.isReady=function(){for(let N of L.values())if(!N.isReady())return!1;return!0}}function l(){function F(O){O.pause(),O.currentTime=0,O.loop=!1}function G(O){var P=!1;this.audio=new Audio(O),this.audio.volume=0.5,this.isReady=function(){return P},this.audio.addEventListener('canplay',function(){P=!0})}const H='audio/',J=new Map([['bgmusic','bgmusic.ogg'],['ding','ding.ogg']]);var M,K=new Map,L=[],N=!1;this.init=function(){var O;for(let P=q;P<=r;P++)O=H+P.toString()+'.ogg',K.set(P,new G(O));for(let[P,Q]of J)O=H+Q,K.set(P,new G(O))},this.isMuted=function(){return N},this.isReady=function(){return K.get('bgmusic').isReady()&&K.get(1970).isReady()},this.play=function(O){N||(K.get(O).audio.play(),L.push(O))},this.loop=function(O){var P=K.get(O).audio;N||(M&&stopLoop(),P.loop=!0,P.play(),M=O)},this.stop=function(O){if(void 0!==O){let P=L.indexOf(O);-1<P&&L.splice(P,1)}else if(O=L.pop(),void 0===O)return;F(K.get(O).audio)},this.stopAll=function(){for(;0<L.length;)this.stop()},this.stopLoop=function(){M&&F(K.get(M).audio),M=null},this.toggleMute=function(){N=!N,N&&(this.stopAll(),this.stopLoop())}}function m(){function F(R){if(R>q)return M+O*(R-(q+1))}function I(R){var S,T;return R<M?q:R>M+N?r:(S=(R-M)/N,T=Math.round((r-(q+1))*S),Math.min(q+1+T,r))}const L=document.querySelector('.slider'),M=153,N=458,O=Math.round(N/(r-(q+1)));var P=new function(){function S(ba){var ca=ba.clientX-B.x,da=I(ca);f(da,Z),Y(ca)}function T(ba){var ca=ba.clientX-B.x,da=I(ca);e(da,Z),document.onmousemove=null,document.onmouseup=null,Z.onmouseup=null}function Y(ba){ba-=$/2,ba=Math.min(Math.max(ba,_),592),Z.style.left=ba+'px'}const Z=document.querySelector('.monorail'),$=Z.clientWidth,_=108;Z.onmousedown=function(ba){0==ba.button&&(document.onmousemove=S,document.onmouseup=T,Z.onmouseup=T,ba.preventDefault())},Y(_),window.addEventListener('setyear',function(ba){var ca=F(ba.detail);ca===void 0&&(ca=_),Y(ca)},!0)},Q=new function(){function R(V){var Y=V.detail,Z=F(Y);Y>q?(T.innerText=Y,T.classList.add('highlight'),T.style.left=Z-U/2+'px'):T.innerText=''}const T=document.querySelector('.wdwe-element.year'),U=T.clientWidth;window.addEventListener('setyear',R,!0),window.addEventListener('slideyear',function(V){var Y=V.detail;Y>q+1&&Y<r?(R(V),T.classList.remove('highlight')):T.innerText=''},!0)};window.addEventListener('keydown',function(R){if(!R.repeat)switch(R.keyCode){case 37:C>q&&e(C-1);break;case 39:C<r&&e(C+1);}},!0),L.addEventListener('click',function(R){if(0==R.button){var S=I(R.clientX-B.x);e(S),R.preventDefault()}},!0)}function n(F,G){this.x=F,this.y=G}const o=640,p=480,q=1970,r=1998;var t,u,v,w,z,A,B,C,D,E;return{init:function(F,G,H){t=document.getElementById(F).getContext('2d'),t.canvas.width=o,t.canvas.height=p,A=parseInt(G),E=H,isNaN(A)&&(A=1e4),b()},isReady:function(){return u},isTimedOut:function(){return z}}}();