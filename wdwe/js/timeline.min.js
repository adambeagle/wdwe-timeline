'use strict';var wdweTimeline=function(){function b(){var E=t.canvas.getBoundingClientRect();u=!1,z=!1,C=q,B=new n(E.left,E.top),v=new k,w=new j,D=new m,v.init(),w.init(),window.addEventListener('setyear',g,!0),c()}function c(E){var F=new Date().getTime();if(E===void 0)E=F;else if(E+A<F)return console.log('Timeout'),z=!0,!1;return v.isReady()&&w.isReady()?void(u=!0,d()):(setTimeout(c,300,E),!0)}function d(){w.start(),e(C)}function e(E,F){var G;F||(F=t.canvas),E=h(E),G=new CustomEvent('setyear',{detail:E,bubbles:!0}),F.dispatchEvent(G)}function f(E,F){var G;F||(F=t.canvas),G=new CustomEvent('slideyear',{detail:E,bubbles:!0}),F.dispatchEvent(G)}function g(E){var F=E.detail;C=F}function h(E){return E=parseInt(E),Math.max(Math.min(E,r),q)}function j(){function E(I){var J=I.detail;H.stop(),J>q&&H.play('ding'),H.play(I.detail)}function F(){H.stop(),H.play(C)}function G(I){H.toggleMute(),H.isMuted()?I.target.innerText='Unmute':(I.target.innerText='Mute',H.loop('bgmusic'))}var H=new l;this.init=function(){window.addEventListener('setyear',E,!0),H.init()},this.isReady=function(){return H.isReady()},this.start=function(){H.loop('bgmusic'),document.querySelector('.repeat-audio').addEventListener('click',F,!0),document.querySelector('.wdwe-container .mute').addEventListener('click',G,!0),t.canvas.addEventListener('click',function(){H.stop()},!0)}}function k(){function E(M){var N=M.detail;for(L=F(N);!L&&N>=q;)L=F(N--);t.drawImage(L,0,0,o,p)}function F(M){var N=K.get(M);return N?N.img:null}function G(M){var N=!1;this.img=new Image,this.img.src=M,this.isReady=function(){return N},this.img.onload=function(){N=!0}}const J=[1970,1971,1974,1975,1976,1982,1988,1989,1990,1991,1992,1994,1995,1996,1997,1998];var L,K=new Map;this.init=function(){var M;for(let N of J)M='images/timeline/'+N.toString()+'.jpg',K.set(N,new G(M));window.addEventListener('setyear',E,!0),window.addEventListener('slideyear',E,!0)},this.isReady=function(){for(let M of K.values())if(!M.isReady())return!1;return!0}}function l(){function E(N){N.pause(),N.currentTime=0,N.loop=!1}function F(N){var O=!1;this.audio=new Audio(N),this.isReady=function(){return O},this.audio.addEventListener('canplay',function(){O=!0})}const G='audio/',I=new Map([['bgmusic','bgmusic.ogg'],['ding','ding.ogg']]);var L,J=new Map,K=[],M=!1;this.init=function(){var N;for(let O=q;O<=r;O++)N=G+O.toString()+'.ogg',J.set(O,new F(N));for(let[O,P]of I)N=G+P,J.set(O,new F(N))},this.isMuted=function(){return M},this.isReady=function(){return J.get('bgmusic').isReady()&&J.get(1970).isReady()},this.play=function(N){M||(J.get(N).audio.play(),K.push(N))},this.loop=function(N){var O=J.get(N).audio;M||(L&&stopLoop(),O.loop=!0,O.play(),L=N)},this.stop=function(N){if(void 0!==N){let O=K.indexOf(N);-1<O&&K.splice(O,1)}else if(N=K.pop(),void 0===N)return;E(J.get(N).audio)},this.stopAll=function(){for(;0<K.length;)this.stop()},this.stopLoop=function(){L&&E(J.get(L).audio),L=null},this.toggleMute=function(){M=!M,M&&(this.stopAll(),this.stopLoop())}}function m(){function E(Q){if(Q>q)return L+N*(Q-(q+1))}function H(Q){var R,S;return Q<L?q:Q>L+M?r:(R=(Q-L)/M,S=Math.round((r-(q+1))*R),Math.min(q+1+S,r))}const K=document.querySelector('.slider'),L=153,M=458,N=Math.round(M/(r-(q+1)));var O=new function(){function R(aa){var ba=aa.clientX-B.x,ca=H(ba);f(ca,Y),V(ba)}function S(aa){var ba=aa.clientX-B.x,ca=H(ba);e(ca,Y),document.onmousemove=null,document.onmouseup=null,Y.onmouseup=null}function V(aa){aa-=Z/2,aa=Math.min(Math.max(aa,$),592),Y.style.left=aa+'px'}const Y=document.querySelector('.monorail'),Z=Y.clientWidth,$=108;Y.onmousedown=function(aa){0==aa.button&&(document.onmousemove=R,document.onmouseup=S,Y.onmouseup=S,aa.preventDefault())},V($),window.addEventListener('setyear',function(aa){var ba=E(aa.detail);ba===void 0&&(ba=$),V(ba)},!0)},P=new function(){function Q(U){var V=U.detail,Y=E(V);V>q?(S.innerText=V,S.classList.add('highlight'),S.style.left=Y-T/2+'px'):S.innerText=''}const S=document.querySelector('.wdwe-element.year'),T=S.clientWidth;window.addEventListener('setyear',Q,!0),window.addEventListener('slideyear',function(U){var V=U.detail;V>q+1&&V<r?(Q(U),S.classList.remove('highlight')):S.innerText=''},!0)};window.addEventListener('keydown',function(Q){if(!Q.repeat)switch(Q.keyCode){case 37:C>q&&e(C-1);break;case 39:C<r&&e(C+1);}},!0),K.addEventListener('click',function(Q){if(0==Q.button){var R=H(Q.clientX-B.x);e(R),Q.preventDefault()}},!0)}function n(E,F){this.x=E,this.y=F}const o=640,p=480,q=1970,r=1998;var t,u,v,w,z,A,B,C,D;return{init:function(E,F){t=document.getElementById(E).getContext('2d'),t.canvas.width=o,t.canvas.height=p,A=parseInt(F),isNaN(A)&&(A=1e4),b()},isReady:function(){return u},isTimedOut:function(){return z}}}();